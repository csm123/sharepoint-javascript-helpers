<div id="components"></div>

<script src="https://csm123.github.io/sharepoint-javascript-helpers/dist/sjh.js"></script>
<script src="https://fb.me/react-0.13.3.js"></script>
<script src="https://fb.me/JSXTransformer-0.13.3.js"></script>

<script type="text/jsx">

	/* Instruct SharePoint to run launchNews on page load */
	SP.SOD.executeFunc("sp.js");
	ExecuteOrDelayUntilScriptLoaded(launchNews, "sp.js");

	/* Functions to get news stories from two different sites */
	var getStories = function() {
		return SJH.getListItems({
	  		list: "News",
	  		fields: ["Title", "Description"],
		});
	};

	var getOtherStories = function() {
		return SJH.getListItems({
	  		list: "News",
	  		fields: ["Title", "Description"],
	  		site: "/News/OtherSite"
		});
	};

	function launchNews() {
		/* Get news stories from both sites */
		SJH.all([getStories(), getOtherStories()]).then(SJH.spread(function(stories, otherStories) {

			/* Once both sites' stories are in, combine them */
			var allStories = stories.concat(otherStories);

			/* Render a React component with the combined set of news stories */
	  		React.render(<News stories={allStories}/>, document.getElementById("components"));
		}));
	}

	var News = React.createClass({
		render: function() {
			/* For each story, render a Story component */
			var stories = this.props.stories.map(function(story) {
				return <Story story={story}/>;
			});
			return (
				<ul>
					{stories}
				</ul>
				)
		}
	});

	var Story = React.createClass({
		getInitialState: function() {
			/* Start the story as nonexpanded */
			return {expanded: false};
		},
		toggle: function(e) {
			/* Toggle the story to be expanded or nonexpanded */
			e.preventDefault();
			this.setState({expanded: !this.state.expanded});
		},
		render: function () {
			var story = this.props.story;
			return (
				<li>
				
					/* If the story is clicked, run 'toggle' above */
					<a href="#" onClick={this.toggle}>{story.Title}</a>

					/* If the story is expanded, show its description */
					{this.state.expanded ?
						<p>{story.Description}</p>
					:
						null
					}
				</li>
			);
		}
	});
</script>
