<div id="components"></div>

<script src="https://csm123.github.io/sharepoint-javascript-helpers/dist/sjh.js"></script>
<script src="https://fb.me/react-0.13.3.js"></script>
<script src="https://fb.me/JSXTransformer-0.13.3.js"></script>
<script type="text/jsx">
SP.SOD.executeFunc("sp.js");
ExecuteOrDelayUntilScriptLoaded(launchNews, "sp.js");

var getStories = function() {
	return SJH.getListItems({
  		list: "News",
  		fields: ["Title", "Description"],
	});
};

var getOtherStories = function() {
	return SJH.getListItems({
  		list: "News",
  		fields: ["Title", "Description"],
  		site: "/News/OtherSite"
	});
};

function launchNews() {

	SJH.all([getStories(), getOtherStories()]).then(SJH.spread(function(stories, otherStories) {
		var allStories = stories.concat(otherStories);
  		React.render(<News stories={allStories}/>, document.getElementById("components"));
	}));

}

var News = React.createClass({
	render: function() {
		var stories = this.props.stories.map(function(story) {
			return <Story story={story}/>;
		});
		return (
			<ul>
				{stories}
			</ul>
			)
	}
});

var Story = React.createClass({
	getInitialState: function() {
		return {expanded: false};
	},
	toggle: function(e) {
		e.preventDefault();
		this.setState({expanded: !this.state.expanded});
	},
	render: function () {
		var story = this.props.story;
		return (
			<li>
				<a href="#" onClick={this.toggle}>{story.Title}</a>
				{this.state.expanded ?
					<p>{story.Description}</p>
				:
					null
				}
			</li>
		);
	}
});

</script>
